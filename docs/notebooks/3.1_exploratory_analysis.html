<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>RNA-Seq using Nextflow: Day 2 â€“ exploratory_analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../lesson.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">RNA-Seq using Nextflow: Day 2</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../setup.html">Setup</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nfcore-rnaseq-to-rstudio" role="button" data-bs-toggle="dropdown" aria-expanded="false">nfcore-rnaseq to RStudio</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nfcore-rnaseq-to-rstudio">    
        <li>
    <a class="dropdown-item" href="../notebooks/1-recap_Day1.html">
 <span class="dropdown-text">RECAP Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/recap_casestudy.html">
 <span class="dropdown-text">Recall the case study</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/1.2_Learning_objectives.html">
 <span class="dropdown-text">Learning objectives</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/2_nextflow_to_RStudio.html">
 <span class="dropdown-text">Setting up R/RStudio on Pawsey Nimbus</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-identifying-differentially-expressed-(de-genes" role="button" data-bs-toggle="dropdown" aria-expanded="false">Identifying differentially expressed (DE) genes</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-identifying-differentially-expressed-(de-genes">    
        <li>
    <a class="dropdown-item" href="../notebooks/3.1_exploratory_analysis.html">
 <span class="dropdown-text">Exploratory analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/4-DE_analysis.html">
 <span class="dropdown-text">Create the DESeqDataSet object in DeSeq2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/4-DE_analysis_2.html">
 <span class="dropdown-text">Identify differentially expressed (DE) genes</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-enrichment-analysis" role="button" data-bs-toggle="dropdown" aria-expanded="false">Enrichment analysis</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-enrichment-analysis">    
        <li>
    <a class="dropdown-item" href="../notebooks/6_Whatis_Enrichment_analysis.html">
 <span class="dropdown-text">What is enrichment analysis?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/7_R_DEGenes_to_functional_enrichments_clusProf.html">
 <span class="dropdown-text">DE genes to functional enrichments</span></a>
  </li>  
    </ul>
  </li>
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#exploratory-analysis" id="toc-exploratory-analysis" class="nav-link active" data-scroll-target="#exploratory-analysis"><strong>Exploratory analysis</strong></a>
  <ul class="collapse">
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives"><strong>Objectives</strong></a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions"><strong>Questions</strong></a></li>
  <li><a href="#exploratory-analysis-and-visualization" id="toc-exploratory-analysis-and-visualization" class="nav-link" data-scroll-target="#exploratory-analysis-and-visualization"><strong>Exploratory analysis and visualization</strong></a>
  <ul class="collapse">
  <li><a href="#box-plot" id="toc-box-plot" class="nav-link" data-scroll-target="#box-plot"><strong>Box plot</strong></a></li>
  <li><a href="#what-is-a-deseq2-object" id="toc-what-is-a-deseq2-object" class="nav-link" data-scroll-target="#what-is-a-deseq2-object"><strong>What is a DESeq2 object?</strong></a></li>
  <li><a href="#normalization" id="toc-normalization" class="nav-link" data-scroll-target="#normalization"><strong>Normalization</strong></a></li>
  <li><a href="#data-transformations" id="toc-data-transformations" class="nav-link" data-scroll-target="#data-transformations"><strong>Data transformations</strong></a></li>
  <li><a href="#variance-stabilisting-transformation-vst" id="toc-variance-stabilisting-transformation-vst" class="nav-link" data-scroll-target="#variance-stabilisting-transformation-vst"><strong>Variance stabilisting transformation (VST)</strong></a></li>
  <li><a href="#re-drawing-the-box-plots" id="toc-re-drawing-the-box-plots" class="nav-link" data-scroll-target="#re-drawing-the-box-plots"><strong>Re-drawing the box plots</strong></a></li>
  <li><a href="#challenge-1" id="toc-challenge-1" class="nav-link" data-scroll-target="#challenge-1"><strong>Challenge #1</strong></a></li>
  <li><a href="#principal-component-analysis-pca" id="toc-principal-component-analysis-pca" class="nav-link" data-scroll-target="#principal-component-analysis-pca"><strong>Principal Component Analysis (PCA)</strong></a></li>
  </ul></li>
  <li><a href="#plot-pca-without-identifying-condition" id="toc-plot-pca-without-identifying-condition" class="nav-link" data-scroll-target="#plot-pca-without-identifying-condition"><strong>Plot PCA without identifying <code>condition</code></strong></a>
  <ul class="collapse">
  <li><a href="#challenge-2" id="toc-challenge-2" class="nav-link" data-scroll-target="#challenge-2"><strong>Challenge #2</strong></a></li>
  <li><a href="#why-choose-best-the-dimension" id="toc-why-choose-best-the-dimension" class="nav-link" data-scroll-target="#why-choose-best-the-dimension"><strong>Why choose best the dimension? </strong> <span class="emoji" data-emoji="grinning">ðŸ˜€</span></a></li>
  <li><a href="#a-scree-plot-can-assist" id="toc-a-scree-plot-can-assist" class="nav-link" data-scroll-target="#a-scree-plot-can-assist"><strong>A Scree plot can assist</strong></a></li>
  <li><a href="#small-contributions-of-many-genes-to-variation" id="toc-small-contributions-of-many-genes-to-variation" class="nav-link" data-scroll-target="#small-contributions-of-many-genes-to-variation"><strong>Small contributions of many genes to variation</strong></a></li>
  <li><a href="#heatmap-sample-to-sample-distances" id="toc-heatmap-sample-to-sample-distances" class="nav-link" data-scroll-target="#heatmap-sample-to-sample-distances"><strong>Heatmap (Sample-to-sample distances)</strong></a></li>
  <li><a href="#challenge-3" id="toc-challenge-3" class="nav-link" data-scroll-target="#challenge-3"><strong>Challenge #3</strong></a></li>
  <li><a href="#key-points" id="toc-key-points" class="nav-link" data-scroll-target="#key-points"><strong>Key points</strong></a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="exploratory-analysis" class="level1">
<h1><strong>Exploratory analysis</strong></h1>
<section id="objectives" class="level3 objectives">
<h3 class="anchored" data-anchor-id="objectives"><strong>Objectives</strong></h3>
<ul>
<li>Perform initial exploratory analysis on the gene-count matrix</li>
</ul>
</section>
<section id="questions" class="level3 questions">
<h3 class="anchored" data-anchor-id="questions"><strong>Questions</strong></h3>
<ul>
<li>How to perform exploratory analysis of the count-matrix?</li>
</ul>
</section>
<section id="exploratory-analysis-and-visualization" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-analysis-and-visualization"><strong>Exploratory analysis and visualization</strong></h2>
<section id="box-plot" class="level3">
<h3 class="anchored" data-anchor-id="box-plot"><strong>Box plot</strong></h3>
<p>RNA-seq data sometimes contain isolated instances of very large counts that are apparently unrelated to the experimental or study design, and which may be considered outliers. <br>A quick look at the distribution of the data across sample using box plots.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">log2</span>((counttable)<span class="sc">+</span><span class="dv">1</span>),<span class="at">las=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red"</span>){width<span class="ot">=</span><span class="dv">50</span>%}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Box plot : before applying transformation</figcaption><p></p>
<p><img src="../fig/box_plot_orig.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><br>There are a number of software packages that have been developed for differential expression analysis of RNA-seq data. An extensive comparison of <code>differential expression analysis of RNA-seq data</code> can be found in <a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-14-91">Soneson and Dleorenzi, 2013</a>. <br>Today we will be using <a href="https://bioconductor.org/packages/release/bioc/html/DESeq2.html">DESeq2</a>, a popular tool for gene-level differential expression analysis. It uses the negative binomial distribution.</p>
</section>
<section id="what-is-a-deseq2-object" class="level3">
<h3 class="anchored" data-anchor-id="what-is-a-deseq2-object"><strong>What is a DESeq2 object?</strong></h3>
<ul>
<li>The basic entity used by the DESeq2 package is an object class called DESeqDataSet. The DESeqDataSet object is used to store both the read counts and the intermediate estimated quantities during statistical analysis We will call this object by name â€˜ddsâ€™ which is a standard practice.</li>
<li>At minimum, we need to at least have a file which maps our samples to the corresponding sample groups that we are investigating <code>(a condition variable)</code>. We will use the columns headers from the counts matrix as the row names of our <code>metadata</code> file and have single column to identify each sample as either â€˜Wild-type (WT)â€™ or â€˜Knockout (KO)â€™</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a condition variable </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>condition<span class="ot">=</span><span class="fu">c</span>(<span class="st">"WT"</span>,<span class="st">"WT"</span>,<span class="st">"WT"</span>,<span class="st">"KO"</span>,<span class="st">"KO"</span>,<span class="st">"KO"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">row.names=</span><span class="fu">colnames</span>(counttable),condition)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(meta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="../fig/meta.png" class="img-fluid" style="width:30.0%"></p>
<ul>
<li>We will now prepare the DESeq2 object with <code>design = ~1</code>.</li>
<li>A design of ~1 is used for no experimental design and is useful for exploring quality of the data (not for identifying differentially expressed -DE genes).</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> counttable, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">colData =</span> meta, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">design =</span> <span class="sc">~</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="normalization" class="level3">
<h3 class="anchored" data-anchor-id="normalization"><strong>Normalization</strong></h3>
<p>To perform the median of ratios method of normalization, DESeq2 has a single <code>estimateSizeFactors()</code> function that will generate size factors. In a typical RNA-seq analysis, this step is automatically performed by the <code>DESeq()</code> function, which we will discuss later.</p>
</section>
<section id="data-transformations" class="level3">
<h3 class="anchored" data-anchor-id="data-transformations"><strong>Data transformations</strong></h3>
<ul>
<li>For visualization or clustering it is useful to work with transformed versions of the count data.</li>
<li>The two most common choices of transformation used for this purpose are -
<ul>
<li>Variance stabilizing transformation (vst)</li>
<li>Regularized log transformation (rlog)</li>
</ul></li>
<li>These algorithms transform the raw count data (which is heteroskedatic - variance grows with the mean) into homoskedatic data (variance is not dependant on the mean).</li>
<li>Both methods produce data on the log2 scale, and normalize for other factors such as library size. Setting <code>blind=TRUE</code> (the default) should be used to compare samples in a manner wholly unbiased about the information about experimental groups, for example to perform sample QC.</li>
</ul>
</section>
<section id="variance-stabilisting-transformation-vst" class="level3">
<h3 class="anchored" data-anchor-id="variance-stabilisting-transformation-vst"><strong>Variance stabilisting transformation (VST)</strong></h3>
<ul>
<li>VST by default uses a subset of 1000 rows to estimate the dispersion trend.</li>
<li>This method is much faster than the other transformation method called - rlog.</li>
<li>Hence, VST is recommended if you have hundreds of samples.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>vst <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds, <span class="at">blind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>vst.data <span class="ot">&lt;-</span> <span class="fu">assay</span>(vst)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Regularized log (rlog) takes a long time with 50 or more samples</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rld &lt;- rlog(dds, blind=FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="re-drawing-the-box-plots" class="level3">
<h3 class="anchored" data-anchor-id="re-drawing-the-box-plots"><strong>Re-drawing the box plots</strong></h3>
<ul>
<li>We will now re-generate the box plots to see if the transformation has brought about any difference in distribution.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(vst.data,<span class="at">las=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Box plot : after applying vst transformation</figcaption><p></p>
<p><img src="../fig/box_plot_transformed.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="challenge-1" class="level3 challenge">
<h3 class="anchored" data-anchor-id="challenge-1"><strong>Challenge #1</strong></h3>
<p>Looking at the above two box plots:</p>
<ul>
<li>Do you see a difference in the two box plots (before and after transformation)?</li>
<li>Do you think the transformation has helped?</li>
</ul>
<details>
<summary>
Solution
</summary>
<p>This is my solution</p>
</details>
</section>
<section id="principal-component-analysis-pca" class="level3">
<h3 class="anchored" data-anchor-id="principal-component-analysis-pca"><strong>Principal Component Analysis (PCA)</strong></h3>
<ul>
<li>PCA is a linear dimensionality reduction technique. Here dimensions are the features (all your thousands of genes from the genome) which represent the data and explain most of the variability.</li>
<li>The data points (here, the samples) are projected onto the 2D plane such that they spread out in the two directions that explain most of the differences.</li>
<li>The percent of the total variance that is contained in the direction is printed in the axis label. <strong>Note</strong> that these percentages do not add to 100%, because there are more dimensions that contain the remaining variance</li>
<li>Ideally, in your experiment, most of the variability should be explained by the conditions (e.g.&nbsp;WT versus KO in our case-study). If any of the samples group-differently, the DE analysis cannot be relied upon.</li>
<li>If we have big number of replicate samples, PCA can assist to identify and remove any outliers.</li>
</ul>
</section>
</section>
<section id="plot-pca-without-identifying-condition" class="level2">
<h2 class="anchored" data-anchor-id="plot-pca-without-identifying-condition"><strong>Plot PCA without identifying <code>condition</code></strong></h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pcaData <span class="ot">&lt;-</span> <span class="fu">plotPCA</span>(vst, <span class="at">intgroup=</span><span class="fu">c</span>(<span class="st">"condition"</span>), <span class="at">returnData=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>percentVar <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">attr</span>(pcaData, <span class="st">"percentVar"</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pcaData, <span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">"PC1: "</span>,percentVar[<span class="dv">1</span>],<span class="st">"% variance"</span>)) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">"PC2: "</span>,percentVar[<span class="dv">2</span>],<span class="st">"% variance"</span>)) <span class="sc">+</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="../fig/PCA_black.png" class="img-fluid" style="width:90.0%"></p>
<section id="challenge-2" class="level3 challenge">
<h3 class="anchored" data-anchor-id="challenge-2"><strong>Challenge #2</strong></h3>
<ul>
<li>Looking at just the PCA, can you guess which samples belong to which conditions?</li>
<li>How did you reach this conclusion?</li>
</ul>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPCA</span>(vst)<span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="../fig/PCA.png" class="img-fluid"></p>
</details>
</section>
<section id="why-choose-best-the-dimension" class="level3">
<h3 class="anchored" data-anchor-id="why-choose-best-the-dimension"><strong>Why choose best the dimension? </strong> <span class="emoji" data-emoji="grinning">ðŸ˜€</span></h3>
<p><img src="../fig/Prince_William_dimensionality.png" class="img-fluid" style="width:50.0%"></p>
</section>
<section id="a-scree-plot-can-assist" class="level3">
<h3 class="anchored" data-anchor-id="a-scree-plot-can-assist"><strong>A Scree plot can assist</strong></h3>
<ul>
<li>The Principal Component matrix has the same dimensions as the original data matrix; however, many of the PCs may not be informative. A reduction in the number of PCs is typically required. To do so, it is useful to examine the amount of variance explained by each new PC vector using a scree plot/</li>
<li>The scree plot is used to determine the number of principal components to keep in a principal component analysis (PCA). It shows the eigenvalues on the y-axis and the number of factors on the x-axis and it always displays a downward curve. The point where the slope of the curve is clearly leveling off (the â€œelbow) indicates the number of factors that should be generated by the analysis. <br><strong>Letâ€™s draw a scree plot</strong></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pca<span class="ot">=</span><span class="fu">prcomp</span>(<span class="fu">t</span>(<span class="fu">assay</span>(vst)),<span class="at">scale=</span><span class="cn">FALSE</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.width=</span><span class="fl">0.5</span>, <span class="at">repr.plot.height=</span><span class="fl">0.5</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(pca, <span class="at">addlabels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="../fig/scree_plot.png" class="img-fluid"></p>
<p><strong>We can see that PC1 followed by PC2 have captured most of the variance</strong></p>
</section>
<section id="small-contributions-of-many-genes-to-variation" class="level3">
<h3 class="anchored" data-anchor-id="small-contributions-of-many-genes-to-variation"><strong>Small contributions of many genes to variation</strong></h3>
<p>It is observed that in biological experiments multiple genes contribute to the the principle compoments in a small way. This can be seen in the plot below where the Y-axis shows the small % contributions of multiple genes to PC1</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The function fviz_contrib() [in factoextra package] is used </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to visualize the contributions of rows/columns from the </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># results of Principal Component Analysis (PCA)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_contrib</span>(pca, <span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">1</span>, <span class="at">top =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="../fig/PCA1_gene_contributions.png" class="img-fluid"></p>
</section>
<section id="heatmap-sample-to-sample-distances" class="level3">
<h3 class="anchored" data-anchor-id="heatmap-sample-to-sample-distances"><strong>Heatmap (Sample-to-sample distances)</strong></h3>
<p>A heatmap of a distance matrix gives us an overview over similarities and dissimilarities between samples. It helps us assess if this fits to the expectation from the experimentâ€™s design.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sampleDists <span class="ot">&lt;-</span> <span class="fu">dist</span>(<span class="fu">t</span>(<span class="fu">assay</span>(vst)))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sampleDistMatrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(sampleDists)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sampleDistMatrix) <span class="ot">&lt;-</span> <span class="fu">paste</span>(vst<span class="sc">$</span>condition, vst<span class="sc">$</span>type, <span class="at">sep=</span><span class="st">"-"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sampleDistMatrix) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>( <span class="fu">rev</span>(<span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">"Blues"</span>)) )(<span class="dv">255</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(sampleDistMatrix,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows=</span>sampleDists,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_cols=</span>sampleDists,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span>colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="../fig/Heatmap_sample_distances.png" class="img-fluid"></p>
</section>
<section id="challenge-3" class="level3 challenge">
<h3 class="anchored" data-anchor-id="challenge-3"><strong>Challenge #3</strong></h3>
<p>Does the heatmap convey information about the samples and the two conditions?</p>
<details>
<summary>
Solution
</summary>
<ul>
<li>The WT samples cluster together.</li>
<li>One of the KO samples is a bit distant to itâ€™s replicates.</li>
</ul>
</details>
</section>
<section id="key-points" class="level3 keypoints">
<h3 class="anchored" data-anchor-id="key-points"><strong>Key points</strong></h3>
<ul>
<li>Exploratory analysis with PCA, scree-plots and heatmap for sample-distances can help us get an initial understanding of the data and figure out if the experimental variability is explained by the conditions of interest.</li>
<li>It can also help to identify and avoid possible outlier samples from the experiment.</li>
</ul>
</section>
<p>*<strong>NOTE</strong> Please see the <a href="http://bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html">guide</a> for detailed information about the DESeq2 library</p>


</section>
</section>

<p>All materials copyright Sydney Informatics Hub, University of Sydney</p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>